<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>GeoAR.js demo</title>
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <script src="https://unpkg.com/aframe-look-at-component@0.8.0/dist/aframe-look-at-component.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script>
      AFRAME.registerComponent('message', {
        update: function() {
          var successFunc = (position) => {
            console.log('update');

            var message = 'lat: ' + position.coords.latitude + ',lon: ' + position.coords.longitude;

            this.el.setAttribute('value', message);
          }
          var errorFunc = (error) => { console.error(error) }
          // navigator.geolocation.getCurrentPosition(successFunc, errorFunc);
          navigator.geolocation.watchPosition(successFunc, errorFunc);

          var deviceOrientation = (orientation) => {
            var alpha = orientation.alpha;

            this.el.setAttribute('value', alpha);
          }
          DeviceOrientationEvent.requestPermission().then((response) => {
            if(response === 'granted') {
              //. 許可された場合のみイベントハンドラを追加できる
              window.addEventListener('deviceorientation', deviceOrientation );
            }
          })
        }
      })
    </script>
  </head>

  <body style="margin: 0; overflow: hidden;">
    <a-scene
      vr-mode-ui="enabled: false"
      embedded
      arjs="sourceType: webcam; debugUIEnabled: false;"
    >
      <a-text
        message
        position="-1.5 1 -4"
        scale="2 2 2"
        color="red">
      </a-text>
      <a-camera gps-camera rotation-reader> </a-camera>
    </a-scene>
  </body>
</html>
